p2 = detect('face1.png', 0);
p1 = detect('face2.png', 0);

img1 = imresize(imread('face1.png'), [300 230]);
img2 = imresize(imread('face2.png'), [300 230]);

figure, imshow(img1);
figure, imshow(img2);

img1 = imgaussfilt(img1);
img2 = imgaussfilt(img2);
[X1, map]= rgb2ind(img1, 3, 'nodither');
figure, imshow(X1,map);
[X1, map]= rgb2ind(img2, 3, 'nodither');
figure, imshow(X1,map);

new_points = zeros(66+17, 2));
p1.points(:,:);
for i=1:17
    new_points(size(p1.points)+i,1) = 0;
    new_points(size(p1.points)+i,2) = p1.points(i,2)*-1 + 300;
end
disp(new_points);
figure, imshow(img2);
imshow(img2);
axis image;
hold on;
plot(new_points(:,1),new_points(:,2),'r.')

%Delaunay points of mean face points
dis = (p1.points+p2.points)/2;
x = dis(:, 1); y = dis(:, 2);
tri = delaunay(x,y);

%https://github.com/GabriellaQiong/Face-Morphing/blob/master/morph.m% 
morphed_im = morph(p1.img*255, p2.img*255, p1.points, p2.points, tri, 1,0 , 0);

%Show image%
%figure, imshowpair(p2.img, morphed_im, 'montage');
morphed_im = im2double(morphed_im);
orig = p2.img;

for i=1:size(orig,1)
    for j=1:size(orig,2)
        if ~(morphed_im(i,j,1) == 0 && morphed_im(i,j,2) == 0 && morphed_im(i,j,3) == 0) 
            orig(i,j,:) = morphed_im(i,j,:);
        end
    end
end

%figure, imshow(orig);

